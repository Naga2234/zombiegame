<!doctype html>
<html lang="ru">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>Zombie Coop (HTTP v8.0)</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600&display=swap" rel="stylesheet">
<script src="https://cdn.socket.io/4.7.5/socket.io.min.js" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.2.0/crypto-js.min.js"></script>
<style>
  :root{
    --bg:#f7faf7; --panel:#ffffff; --border:#e5e7eb; --muted:#64748b; --text:#0f172a;
    --btn:#f1f5f9; --btnb:#cbd5e1; --primary:#22c55e; --primaryb:#16a34a;
    --good:#16a34a; --bad:#ef4444; --accent:#60a5fa;
  }
  *{box-sizing:border-box} body{font-family:'Inter',system-ui,Arial;background:var(--bg);margin:0;color:var(--text)}
  header{display:flex;align-items:center;justify-content:space-between;padding:12px 16px;background:#ffffff;border-bottom:1px solid var(--border);transition:background .3s ease,color .3s ease}
  .wrap{display:flex;min-height:calc(100vh - 56px);transition:padding .3s ease}
  aside{width:360px;background:var(--panel);border-right:1px solid var(--border);padding:16px;overflow:auto;transition:background .3s ease,border-color .3s ease,box-shadow .3s ease}
  main{flex:1;display:flex;align-items:flex-start;justify-content:center;padding:24px 16px}
  .btn{display:inline-flex;align-items:center;gap:6px;padding:10px 14px;margin:4px 0;border:1px solid var(--btnb);border-radius:10px;background:var(--btn);cursor:pointer}
  .btn.primary{background:var(--primary);color:#fff;border-color:var(--primaryb)}
  .btn:disabled{opacity:.55;cursor:not-allowed}
  .muted{color:var(--muted);font-size:12px}
  .row{margin:8px 0}
  .login-row{display:flex;gap:8px;align-items:center}
  .login-row input{flex:1}
  .login-row .btn{margin:0;white-space:nowrap}
  .main-home{width:100%;max-width:clamp(320px,92vw,920px);display:flex;flex-direction:column;gap:12px}
  .main-home h3{margin:0}
  .auth-card{background:rgba(255,255,255,0.95);border-radius:24px;padding:32px 28px;box-shadow:0 24px 60px rgba(15,23,42,0.25);display:flex;flex-direction:column;gap:16px;border:1px solid rgba(255,255,255,0.45);backdrop-filter:blur(10px)}
  .auth-card__header h1{margin:0;font-size:28px;line-height:1.2}
  .auth-card__subtitle{margin:4px 0 0;font-size:16px;color:var(--muted)}
  .auth-card__hint{margin:0;color:var(--muted);line-height:1.5}
  .auth-card__label{font-weight:600;font-size:14px;margin-top:4px}
  .auth-card__indicators{min-height:18px}
  .auth-card__status{font-size:12px}
  .auth-card__actions{display:flex;gap:8px;flex-wrap:wrap}
  .auth-card__helper{font-size:12px;line-height:1.4}
  .auth-illustration{background:rgba(15,23,42,0.35);border-radius:28px;padding:32px;display:flex;flex-direction:column;gap:12px;box-shadow:0 30px 80px rgba(8,47,73,0.45);backdrop-filter:blur(6px);max-width:420px}
  .auth-illustration h2{margin:0;font-size:26px;line-height:1.25}
  .auth-illustration__badge{width:64px;height:64px;border-radius:20px;background:rgba(34,197,94,0.25);display:flex;align-items:center;justify-content:center;font-size:32px;color:#bbf7d0}
  .auth-illustration__list{margin:0;padding-left:20px;display:flex;flex-direction:column;gap:6px;font-size:14px;color:rgba(226,232,240,0.85)}
  body.auth-view{background:radial-gradient(1200px at 10% 10%,rgba(34,197,94,0.22),transparent 55%),radial-gradient(900px at 90% 20%,rgba(59,130,246,0.18),transparent 60%),linear-gradient(135deg,#0f172a 0%,#1f2937 45%,#0b1120 100%);color:#e2e8f0}
  body.auth-view header{background:rgba(15,23,42,0.2);border-bottom:1px solid rgba(226,232,240,0.2);color:#f8fafc}
  body.auth-view header .muted{color:rgba(226,232,240,0.75)}
  body.auth-view .wrap{justify-content:center;align-items:center;padding:48px 32px;gap:48px}
  body.auth-view aside{width:min(420px,100%);background:transparent;border-right:none;padding:0;overflow:visible;box-shadow:none}
  body.auth-view main{flex:0 1 420px;padding:0;color:#f8fafc}
  body.auth-view main:empty{display:none}
  body.auth-view main .auth-illustration{color:#f8fafc}
  body.auth-view aside .muted{color:#64748b}
  body.auth-view .auth-card__status{color:var(--muted)}
  @media (max-width:520px){
    .login-row{flex-direction:column;align-items:stretch}
    .login-row .btn{width:100%;justify-content:center;margin-top:8px}
    .auth-card{padding:28px 22px;border-radius:20px}
    .auth-card__actions{flex-direction:column}
    .auth-card__actions .btn{width:100%;justify-content:center}
  }
  @media (max-width:768px){
    body.auth-view .wrap{flex-direction:column;padding:32px 16px 48px;gap:32px}
    body.auth-view main{display:none}
    body.auth-view header{background:rgba(15,23,42,0.35)}
  }
  input,select,button{font-family:'Inter',system-ui,Arial}
  input,select{width:100%;padding:10px;border:1px solid var(--btnb);border-radius:10px;box-sizing:border-box}
  h2{margin:8px 0}
  canvas{background:#eaffea;border:1px solid #a7f3d0; cursor:crosshair}
  .sep{height:1px;background:var(--border);margin:12px 0}
  .pill{display:inline-flex;align-items:center;gap:6px;padding:4px 8px;border-radius:999px;border:1px solid var(--border);background:#f8fafc;margin:2px; cursor:pointer}
  .ready{color:var(--good)} .notready{color:var(--bad)}
  .room{border:1px solid var(--border);border-radius:12px;padding:8px;margin:8px 0;background:#f8fff8;width:100%}
  .room .btn{width:100%;justify-content:center}
  .room-layout{display:flex;gap:18px;width:100%;max-width:980px;align-items:stretch}
  .room-panel{background:var(--panel);border:1px solid var(--border);border-radius:18px;padding:18px;display:flex;flex-direction:column;gap:16px;box-shadow:0 12px 35px rgba(15,23,42,0.08)}
  .room-panel--info{flex:1;min-width:0}
  .room-panel--chat{width:360px;max-width:100%}
  .room-panel__header{display:flex;align-items:center;justify-content:space-between;gap:12px}
  .room-panel__title{margin:0;font-size:18px}
  .room-panel__section{display:flex;flex-direction:column;gap:12px}
  .room-info{display:flex;flex-direction:column;gap:8px}
  .room-info__feedback{font-size:12px;color:var(--muted);min-height:16px;opacity:0;transition:opacity .25s ease}
  .room-info__feedback.is-visible{opacity:1}
  .room-roster{border:1px solid var(--border);border-radius:14px;background:#ffffff;min-height:140px;display:flex;flex-direction:column}
  .room-roster__list{flex:1;overflow-y:auto;padding:12px;display:grid;grid-template-columns:repeat(auto-fill,minmax(220px,1fr));gap:10px;align-content:flex-start}
  .room-roster__summary{grid-column:1/-1;font-size:12px;color:var(--muted);display:flex;justify-content:flex-end;align-items:center;padding:0 2px 4px}
  .player-tile{display:flex;align-items:center;gap:12px;padding:10px;border-radius:12px;border:1px solid var(--border);background:#f8fafc;transition:transform .15s ease,box-shadow .15s ease;cursor:pointer}
  .player-tile:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(15,23,42,0.08)}
  .player-tile--ready{border-color:rgba(34,197,94,0.4);background:rgba(34,197,94,0.12)}
  .player-tile--host{box-shadow:0 0 0 2px rgba(96,165,250,0.35)}
  .player-tile__avatar{width:42px;height:42px;border-radius:14px;object-fit:cover;border:2px solid rgba(148,163,184,0.4)}
  .player-tile--ready .player-tile__avatar{border-color:rgba(34,197,94,0.45)}
  .player-tile__info{flex:1;min-width:0;display:flex;flex-direction:column;gap:4px}
  .player-tile__name{font-weight:600;font-size:14px;color:var(--text);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
  .player-tile__role{font-size:12px;color:var(--muted);display:flex;align-items:center;gap:6px}
  .player-tile__badges{display:flex;flex-direction:column;gap:6px;align-items:flex-end}
  .player-tile__badge{font-size:11px;padding:2px 8px;border-radius:999px;border:1px solid var(--border);background:#fff;display:inline-flex;align-items:center;gap:4px;white-space:nowrap}
  .player-tile__badge--ready{border-color:rgba(34,197,94,0.5);background:rgba(34,197,94,0.15);color:var(--good)}
  .player-tile__badge--waiting{border-color:rgba(239,68,68,0.45);background:rgba(254,226,226,0.45);color:var(--bad)}
  .player-tile__badge--host{border-color:rgba(96,165,250,0.45);background:rgba(219,234,254,0.7);color:#1d4ed8;font-weight:600}
  .room-roster__empty{padding:12px;color:var(--muted);grid-column:1/-1}
  .room-roster__countdown{min-height:18px}
  .room-chat__log{border:1px solid var(--border);border-radius:14px;background:#ffffff;padding:12px;height:360px;overflow:auto}
  .room-chat__form{display:flex;gap:8px;align-items:center}
  .room-chat__form input{flex:1}
  .chat-message{font-size:13px;line-height:1.35;margin-bottom:6px;display:flex;align-items:flex-start;gap:6px}
  .chat-message:last-child{margin-bottom:0}
  .chat-message__time{font-size:11px;color:var(--muted);flex-shrink:0;min-width:42px}
  .chat-message__author{font-weight:600}
  .chat-message__text{white-space:pre-wrap;word-break:break-word}
  .chat-message--system .chat-message__author,.chat-message--system .chat-message__text{color:var(--muted)}
  .room-actions{display:flex;flex-wrap:wrap;gap:8px;margin:12px 0}
  .room-actions:empty{display:none;margin:0}
  .room-actions--single{justify-content:flex-start}
  .room-actions--column{flex-direction:column;align-items:flex-start}
  .room-actions .btn{margin:0}
  .room-role{display:flex;flex-direction:column;gap:8px;width:100%}
  .room-role__choices{display:flex;flex-wrap:wrap;gap:8px}
  .room-layout + .muted{margin-top:12px}
  @media (max-width:1100px){
    .room-layout{flex-direction:column}
    .room-panel--chat{width:100%}
  }
  @media (max-width:720px){
    .room-panel{padding:16px;border-radius:16px}
    .room-chat__log{height:320px}
  }
  @media (max-width:640px){
    .room-panel__header{flex-direction:column;align-items:flex-start}
    .room-chat__form{flex-direction:column;align-items:stretch}
    .room-chat__form .btn{width:100%;justify-content:center}
  }
  .rooms-container{display:flex;flex-direction:column;gap:12px;min-height:120px;width:100%}
  .rooms-loading{padding:32px 0;text-align:center;color:var(--muted);font-size:14px}
  .empty-state{border:1px dashed var(--border);border-radius:16px;padding:32px 24px;background:#ffffff;display:flex;flex-direction:column;align-items:center;gap:12px;text-align:center;color:var(--muted)}
  .empty-state__icon{font-size:36px;line-height:1}
  .empty-state__title{font-weight:600;font-size:18px;color:var(--text)}
  .empty-state__text{font-size:14px;max-width:320px}
  .grid{display:grid;grid-template-columns:repeat(6,minmax(0,1fr));gap:6px}
  .card{border:1px solid var(--border);border-radius:12px;padding:10px;background:#ffffff;display:flex;align-items:center;gap:10px;cursor:pointer;user-select:none;transition:filter .15s,outline .15s,box-shadow .15s ease,transform .15s ease;width:100%}
  .card:hover{transform:translateY(-2px);box-shadow:0 8px 18px rgba(15,23,42,0.08)}
  .card.disabled{filter:grayscale(1);opacity:.65;cursor:not-allowed;transform:none;box-shadow:none}
  .card.selected{outline:2px solid var(--accent);box-shadow:0 0 0 2px rgba(96,165,250,0.25)}
  .icon{width:28px;height:28px;display:inline-flex;align-items:center;justify-content:center;font-size:18px}
  .inventory-card{align-items:stretch;padding:12px;gap:12px;position:relative;overflow:hidden}
  .inventory-card.is-locked::after{content:'';position:absolute;inset:0;background:rgba(148,163,184,0.08);backdrop-filter:blur(1px)}
  .inventory-card__icon{width:38px;height:38px;border-radius:12px;background:linear-gradient(135deg,rgba(96,165,250,0.18),rgba(45,212,191,0.16));display:flex;align-items:center;justify-content:center;font-size:22px;flex-shrink:0}
  .inventory-card__body{flex:1;min-width:0;display:flex;flex-direction:column;gap:6px}
  .inventory-card__header{display:flex;align-items:flex-start;justify-content:space-between;gap:6px;font-size:14px;font-weight:600;color:var(--text)}
  .inventory-card__name{flex:1;min-width:0}
  .inventory-card__key{padding:2px 6px;border-radius:6px;background:rgba(96,165,250,0.15);color:#1d4ed8;font-size:11px;font-weight:600}
  .inventory-card__meta{display:flex;align-items:center;gap:8px;font-size:12px;color:var(--muted)}
  .inventory-card__cost{font-weight:600;color:var(--text)}
  .inventory-card__hp{padding:2px 6px;border-radius:999px;background:rgba(34,197,94,0.12);color:var(--good);font-weight:600}
  .inventory-card__progress{height:6px;border-radius:999px;background:rgba(148,163,184,0.2);overflow:hidden;opacity:0;transition:opacity .15s ease}
  .inventory-card__progress.is-visible{opacity:1}
  .inventory-card__progress span{display:block;height:100%;background:linear-gradient(90deg,#f97316,#facc15);transition:width .2s ease}
  .inventory-card__status{font-size:11px;color:var(--muted);margin-top:2px}
  .inventory-card__status--ready{color:var(--good);font-weight:600}
  .badge{font-size:12px;padding:2px 6px;border-radius:8px;border:1px solid var(--border);background:#fff}
  .modal{position:fixed;inset:0;background:rgba(0,0,0,.35);display:none;align-items:center;justify-content:center;padding:16px}
  .modal__content{display:flex;align-items:center;justify-content:center}
  .modal > .box,
  .modal__content .box{background:#fff;border-radius:14px;min-width:320px;max-width:520px;max-height:90vh;padding:16px;border:1px solid var(--border);overflow-y:auto}
  #roomName:focus{outline:2px solid var(--accent);border-color:var(--accent);box-shadow:0 0 0 3px rgba(96,165,250,0.35)}
  #shopBox{display:flex;flex-direction:column;gap:8px}
  .shop-items{max-height:60vh;overflow-y:auto;padding-right:4px}
  .avatar{width:28px;height:28px;border-radius:999px;vertical-align:middle;margin-right:8px}
  .pass-strength{margin:6px 0 12px;transition:all .25s ease}
  .pass-strength__track{width:100%;height:8px;border-radius:999px;background:var(--border);overflow:hidden}
  .pass-strength__bar{height:100%;width:0%;background:var(--bad);transition:width .25s ease,background .25s ease}
  .pass-strength__label{margin-top:4px;font-size:12px;color:var(--muted);transition:color .25s ease}
  .pass-strength.is-empty .pass-strength__bar{width:0%}
  .pass-strength.level-1 .pass-strength__bar{background:#f97316}
  .pass-strength.level-2 .pass-strength__bar{background:#facc15}
  .pass-strength.level-3 .pass-strength__bar{background:var(--accent)}
  .pass-strength.level-4 .pass-strength__bar{background:var(--good)}
  .pass-strength.level-3 .pass-strength__label,
  .pass-strength.level-4 .pass-strength__label{color:var(--text)}
  .profile-section-title{font-weight:600;font-size:16px;margin:4px 0 12px}
  .profile-tabs{display:flex;gap:8px;flex-wrap:wrap;margin-bottom:12px}
  .profile-tabs .btn{margin:0}
  .profile-inventory-list{display:grid;grid-template-columns:repeat(auto-fill,minmax(150px,1fr));gap:10px}
  .profile-item{border:1px solid var(--border);border-radius:12px;padding:10px;background:#f8fafc;display:flex;gap:10px;align-items:center;min-height:56px}
  .profile-item-icon{font-size:20px;width:32px;height:32px;display:flex;align-items:center;justify-content:center;background:#fff;border-radius:10px}
  .profile-item-title{font-weight:600;font-size:14px}
  .profile-item-sub{font-size:12px;color:var(--muted);margin-top:2px}
  @media (max-width:960px){
    body:not(.auth-view) aside{width:280px}
    body:not(.auth-view) .main-home{max-width:clamp(320px,96vw,860px)}
  }
  @media (max-width:720px){
    body:not(.auth-view) .wrap{flex-direction:column}
    body:not(.auth-view) aside{width:100%;border-right:none;border-bottom:1px solid var(--border)}
    body:not(.auth-view) main{width:100%;padding:20px 16px;justify-content:flex-start}
    body:not(.auth-view) .main-home{max-width:100%}
  }
  @media (max-width:480px){
    .profile-inventory-list{grid-template-columns:repeat(auto-fill,minmax(130px,1fr))}
  }
</style>
</head>
<body>
<header>
  <div><b>Zombie Coop v8.0</b></div>
  <div id="navbar" class="muted"></div>
</header>

<div class="wrap">
  <aside id="leftPanel"></aside>
  <main id="mainPanel"></main>
</div>

<div class="modal" id="createModal">
  <div class="modal__content">
    <div class="box">
      <h3>Создать игру</h3>
      <div class="row"><label>Название комнаты</label>
        <input id="roomName" placeholder="Например: Вечерний кооп" />
      </div>
      <div class="row"><label>Пароль (необязательно)</label>
        <input id="roomPass" placeholder="Оставь пустым для публичной" />
      </div>
      <div class="row"><label>Режим</label>
        <select id="modeSelect"><option value="coop">Coop</option><option value="pvp">PvP</option><option value="survival" disabled>Survival (WIP)</option></select>
      </div>
      <div class="row"><label>Количество игроков</label>
        <select id="maxPlayers"><option>2</option><option disabled>3</option><option disabled>4</option></select>
      </div>
      <div class="row" style="text-align:right">
        <button class="btn" onclick="closeModal()">Отмена</button>
        <button class="btn primary" onclick="confirmCreate()">Создать</button>
      </div>
    </div>
  </div>
</div>

<div class="modal" id="profileModal">
  <div class="box">
    <div id="profileBox">Загрузка...</div>
    <div style="display:flex;justify-content:flex-end;align-items:center;margin-top:8px;gap:8px">
      <button class="btn" onclick="logout()"><span>🚪</span> Выйти</button>
      <button class="btn" onclick="closeProfile()">Закрыть</button>
    </div>
  </div>
</div>

<div class="modal" id="shopModal">
  <div class="box">
    <h3>Магазин</h3>
    <div id="shopBox" class="muted">Загрузка...</div>
    <div style="text-align:right;margin-top:8px"><button class="btn" onclick="closeShop()">Закрыть</button></div>
  </div>
</div>

<div class="modal" id="craftModal">
  <div class="box">
    <h3>Крафт</h3>
    <div id="craftBox" class="muted">Здесь пока пусто...</div>
    <div style="text-align:right;margin-top:8px"><button class="btn" onclick="closeCraft()">Закрыть</button></div>
  </div>
</div>

<script src="/app.js"></script>
</body>
</html>
